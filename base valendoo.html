<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha Cadastral</title>
    <style>
        /* CSS INALTERADO */
        @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap");
        @import url("https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap");

        body {
            font-family: Arial, sans-serif;
            font-size: 11px;
            width: 800px;
            margin: 20px auto;
            border: 1px solid #ccc;
            padding: 20px;
        }

        /* ESTILOS CORRIGIDOS DO CABEÇALHO */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #000;
            color: #fff;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 18px;
            margin: 0;
            flex-grow: 1;
        }

        .header .logo {
            height: 50px;
            margin-right: 15px;
        }

        .header .info {
            font-size: 10px;
            text-align: right;
        }

        .header .info p {
            margin: 0;
        }

        /* ESTILOS DE FORMATAÇÃO E INPUTS */
        h2 {
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
            margin-top: 20px;
            font-size: 14px;
        }

        h3 {
            font-size: 12px;
            margin-top: 15px;
            margin-bottom: 5px;
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
            align-items: center;
        }

        .form-item {
            display: flex;
            flex-direction: column;
            margin-right: 20px;
            position: relative;
        }

        .form-item label {
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 3px;
        }

        .form-item input[type="text"],
        .form-item input[type="number"],
        .form-item input[type="date"],
        .form-item select {
            width: 200px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 11px;
        }

        .form-item.full-width {
            width: 100%;
        }

        .form-item.full-width input,
        .form-item.full-width select {
            width: 100%;
        }

        .form-item.large-input {
            width: 300px;
        }

        .form-item.large-input input {
            width: 300px;
        }

        .form-item.medium-input {
            width: 250px;
        }

        .form-item.medium-input input {
            width: 250px;
        }

        .form-item.small-input {
            width: 100px;
        }

        .form-item.small-input input {
            width: 100px;
        }

        .add-button, .remove-button {
            padding: 5px 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 11px;
            margin-top: 5px;
        }

        .add-button {
            background-color: #4CAF50;
            color: white;
            margin-left: 10px;
        }

        .remove-button {
            background-color: #f44336;
            color: white;
            margin-left: 10px;
        }
        
        .dynamic-list {
            border: 1px dashed #ccc;
            padding: 10px;
            margin-top: 10px;
        }

        .list-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .list-item .form-item {
            margin-right: 10px;
            margin-bottom: 5px;
        }

        .list-item .remove-button {
            align-self: flex-start;
        }

        .footer {
            margin-top: 20px;
            font-size: 10px;
            text-align: center;
        }

        .footer span {
            display: block;
            margin-top: 5px;
        }

        .form-item input[type="checkbox"] {
            margin-top: 10px;
        }

        .form-item.checkbox-item {
            flex-direction: row;
            align-items: center;
        }

        .form-item.checkbox-item input {
            width: auto;
            margin-right: 5px;
        }

        .form-item.checkbox-item label {
            font-weight: normal;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .button-group button {
            margin-left: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .button-group #saveBtn {
            background-color: #4CAF50;
            color: white;
        }
        
        .button-group #loadBtn {
            background-color: #008CBA;
            color: white;
        }
        
        /* ADICIONADO: ESTILO PARA O ÍCONE DE INFORMAÇÃO */
        .info-icon {
            color: #008CBA;
            font-size: 12px;
            margin-left: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://i.ibb.co/6P6Ym90/logo.png" alt="logo" border="0" class="logo">
        <h1>Ficha Cadastral</h1>
        <div class="info">
            <p>Data de Emissão: <span id="dataEmissao"></span></p>
        </div>
    </div>
    <form id="fichaCadastralForm">
        <div class="form-section">
            <h2>Dados do Cliente</h2>
            <div class="form-row">
                <div class="form-item large-input">
                    <label for="nome">Nome Completo</label>
                    <input type="text" id="nome" name="nome" title="Informe o nome completo do cliente." required>
                    <i class="info-icon" title="Informe o nome completo do cliente.">i</i>
                </div>
                <div class="form-item medium-input">
                    <label for="cpf">CPF</label>
                    <input type="text" id="cpf" name="cpf" class="cpf-mask" title="Informe o CPF do cliente.">
                    <i class="info-icon" title="Informe o CPF do cliente.">i</i>
                </div>
                <div class="form-item medium-input">
                    <label for="rg">RG</label>
                    <input type="text" id="rg" name="rg" title="Informe o RG do cliente.">
                    <i class="info-icon" title="Informe o RG do cliente.">i</i>
                </div>
                <div class="form-item small-input">
                    <label for="dataNascimento">Data de Nascimento</label>
                    <input type="date" id="dataNascimento" name="dataNascimento" title="Informe a data de nascimento do cliente.">
                    <i class="info-icon" title="Informe a data de nascimento do cliente.">i</i>
                </div>
                <div class="form-item medium-input">
                    <label for="estadoCivil">Estado Civil</label>
                    <select id="estadoCivil" name="estadoCivil" title="Informe o estado civil do cliente.">
                        <option value="">Selecione</option>
                        <option value="solteiro">Solteiro(a)</option>
                        <option value="casado">Casado(a)</option>
                        <option value="divorciado">Divorciado(a)</option>
                        <option value="viuvo">Viúvo(a)</option>
                        <option value="uniao_estavel">União Estável</option>
                    </select>
                    <i class="info-icon" title="Informe o estado civil do cliente.">i</i>
                </div>
                <div class="form-item large-input" id="conjugeFields" style="display: none;">
                    <label for="nomeConjuge">Nome do Cônjuge</label>
                    <input type="text" id="nomeConjuge" name="nomeConjuge" title="Informe o nome completo do cônjuge.">
                    <i class="info-icon" title="Informe o nome completo do cônjuge.">i</i>
                </div>
                <div class="form-item large-input" id="conjugeCpfFields" style="display: none;">
                    <label for="cpfConjuge">CPF do Cônjuge</label>
                    <input type="text" id="cpfConjuge" name="cpfConjuge" class="cpf-mask" title="Informe o CPF do cônjuge.">
                    <i class="info-icon" title="Informe o CPF do cônjuge.">i</i>
                </div>
                <div class="form-item large-input">
                    <label for="endereco">Endereço Completo</label>
                    <input type="text" id="endereco" name="endereco" title="Informe o endereço completo do cliente.">
                    <i class="info-icon" title="Informe o endereço completo do cliente.">i</i>
                </div>
                <div class="form-item medium-input">
                    <label for="cidade">Cidade</label>
                    <input type="text" id="cidade" name="cidade" title="Informe a cidade do cliente.">
                    <i class="info-icon" title="Informe a cidade do cliente.">i</i>
                </div>
                <div class="form-item small-input">
                    <label for="estado">Estado</label>
                    <input type="text" id="estado" name="estado" title="Informe o estado do cliente.">
                    <i class="info-icon" title="Informe o estado do cliente.">i</i>
                </div>
                <div class="form-item medium-input">
                    <label for="telefone">Telefone</label>
                    <input type="text" id="telefone" name="telefone" class="phone-mask" title="Informe o telefone do cliente.">
                    <i class="info-icon" title="Informe o telefone do cliente.">i</i>
                </div>
                <div class="form-item medium-input">
                    <label for="email">Email</label>
                    <input type="text" id="email" name="email" title="Informe o email do cliente.">
                    <i class="info-icon" title="Informe o email do cliente.">i</i>
                </div>
                <div class="form-item full-width">
                    <label for="atividade">Atividade Principal</label>
                    <input type="text" id="atividade" name="atividade" title="Informe a principal atividade econômica do cliente.">
                    <i class="info-icon" title="Informe a principal atividade econômica do cliente.">i</i>
                </div>
                <div class="form-item checkbox-item">
                    <label for="pep">O cliente é uma Pessoa Exposta Politicamente (PEP)?</label>
                    <input type="checkbox" id="pep" name="pep" title="Marque se o cliente é uma Pessoa Exposta Politicamente.">
                    <i class="info-icon" title="Marque se o cliente é uma Pessoa Exposta Politicamente.">i</i>
                </div>
                <div class="form-item medium-input" id="pepRelacionamentoFields" style="display: none;">
                    <label for="pepRelacionamento">Qual o relacionamento?</label>
                    <input type="text" id="pepRelacionamento" name="pepRelacionamento" title="Especifique o relacionamento com a PEP.">
                    <i class="info-icon" title="Especifique o relacionamento com a PEP.">i</i>
                </div>
            </div>
        </div>
        <div class="form-section">
            <h2>Rendas e Patrimônios</h2>
            <div class="form-row">
                <div class="form-item">
                    <label for="rendaTotalMensal">Renda Total Mensal (R$)</label>
                    <input type="text" id="rendaTotalMensal" name="rendaTotalMensal" class="money-mask" title="Informe a renda mensal total do cliente.">
                    <i class="info-icon" title="Informe a renda mensal total do cliente.">i</i>
                </div>
                <div class="form-item">
                    <label for="patrimonioTotal">Patrimônio Total (R$)</label>
                    <input type="text" id="patrimonioTotal" name="patrimonioTotal" class="money-mask" title="Informe o patrimônio total do cliente.">
                    <i class="info-icon" title="Informe o patrimônio total do cliente.">i</i>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h2>Rendas de Safras</h2>
            <div id="rendas-safra-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('rendas-safra-container', 'renda-safra')">Adicionar Renda de Safra</button>
        </div>

        <div class="form-section">
            <h2>Projeção de Safras</h2>
            <div id="projecao-safra-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('projecao-safra-container', 'projecao-safra')">Adicionar Projeção de Safra</button>
        </div>

        <div class="form-section">
            <h2>Imóveis</h2>
            <div id="imoveis-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('imoveis-container', 'imoveis')">Adicionar Imóvel</button>
        </div>

        <div class="form-section">
            <h2>Veículos</h2>
            <div id="veiculos-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('veiculos-container', 'veiculos')">Adicionar Veículo</button>
        </div>

        <div class="form-section">
            <h2>Máquinas</h2>
            <div id="maquinas-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('maquinas-container', 'maquinas')">Adicionar Máquina</button>
        </div>

        <div class="form-section">
            <h2>Áreas Próprias</h2>
            <div id="areas-proprias-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('areas-proprias-container', 'areas-proprias')">Adicionar Área Própria</button>
        </div>

        <div class="form-section">
            <h2>Áreas Arrendadas</h2>
            <div id="areas-arrendadas-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('areas-arrendadas-container', 'areas-arrendadas')">Adicionar Área Arrendada</button>
        </div>

        <div class="form-section">
            <h2>Seguros</h2>
            <div id="seguros-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('seguros-container', 'seguros')">Adicionar Seguro</button>
        </div>

        <div class="form-section">
            <h2>Conglomerado</h2>
            <div id="conglomerado-container" class="dynamic-list"></div>
            <button type="button" class="add-button" onclick="addDynamicItem('conglomerado-container', 'conglomerado')">Adicionar Conglomerado</button>
        </div>

        <div class="button-group">
            <button type="button" id="loadBtn">Importar Dados</button>
            <button type="button" id="saveBtn">Exportar Dados</button>
        </div>

    </form>
    <div class="footer">
        <span>© 2024 Ficha Cadastral. Todos os direitos reservados.</span>
        <span>Desenvolvido por [Nome da Sua Empresa/Equipe]</span>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
    const dataEmissao = new Date().toLocaleDateString('pt-BR');
    document.getElementById('dataEmissao').textContent = dataEmissao;

    function applyMasks() {
        $('.cpf-mask').mask('000.000.000-00');
        $('.phone-mask').mask('(00) 00000-0000');
        $('.money-mask').mask('000.000.000.000.000,00', {reverse: true, placeholder: "0,00"});
    }

    function reapplyAllMasks() {
        applyMasks();
        document.querySelectorAll('.renda-safra-item .money-mask, .projecao-safra-item .money-mask').forEach(input => {
            $(input).mask('000.000.000.000.000,00', {reverse: true, placeholder: "0,00"});
        });
    }

    function createFormItem(label, name, type, maskClass, titleText) {
        const div = document.createElement('div');
        div.className = 'form-item';
        if (maskClass === 'full-width') div.classList.add('full-width');
        
        const labelEl = document.createElement('label');
        labelEl.textContent = label;
        labelEl.htmlFor = name;

        let inputEl;
        if (type === 'select') {
            inputEl = document.createElement('select');
            const placeholderOption = document.createElement('option');
            placeholderOption.value = "";
            placeholderOption.textContent = "Selecione";
            inputEl.appendChild(placeholderOption);
        } else {
            inputEl = document.createElement('input');
            inputEl.type = type;
        }

        inputEl.id = name;
        inputEl.name = name;
        if (maskClass) {
            inputEl.classList.add(maskClass);
        }

        const infoIcon = document.createElement('i');
        infoIcon.className = 'info-icon';
        infoIcon.title = titleText;
        infoIcon.textContent = 'i';

        div.appendChild(labelEl);
        div.appendChild(inputEl);
        div.appendChild(infoIcon);
        
        return div;
    }

    function addDynamicItem(containerId, listType) {
        const container = document.getElementById(containerId);
        const item = document.createElement('div');
        item.className = 'list-item ' + listType + '-item';

        const index = container.children.length;
        const baseId = listType + '-' + index;

        let inputs = [];
        if (listType === 'renda-safra') {
            inputs.push(createFormItem('Ano da Safra', baseId + '-ano', 'text', null, 'Informe o ano da safra.'));
            inputs.push(createFormItem('Tipo de Safra', baseId + '-tipo', 'select', null, 'Selecione o tipo de safra (ex: Soja, Milho).'));
            inputs.push(createFormItem('Área (ha)', baseId + '-area', 'text', null, 'Informe a área da safra em hectares.'));
            inputs.push(createFormItem('Produtividade (sc/ha)', baseId + '-produtividade', 'text', null, 'Informe a produtividade da safra em sacas por hectare.'));
            inputs.push(createFormItem('Preço de Venda (R$/sc)', baseId + '-preco', 'text', 'money-mask', 'Informe o preço de venda por saca.'));
            inputs.push(createFormItem('Valor Total (R$)', baseId + '-valor', 'text', 'money-mask', 'Valor total da produção (calculado automaticamente).'));
        } else if (listType === 'projecao-safra') {
            inputs.push(createFormItem('Ano da Projeção', baseId + '-ano', 'text', null, 'Informe o ano da projeção de safra.'));
            inputs.push(createFormItem('Tipo de Safra', baseId + '-tipo', 'select', null, 'Selecione o tipo de safra.'));
            inputs.push(createFormItem('Área (ha)', baseId + '-area', 'text', null, 'Informe a área da safra em hectares.'));
            inputs.push(createFormItem('Produtividade (sc/ha)', baseId + '-produtividade', 'text', null, 'Informe a produtividade da safra em sacas por hectare.'));
            inputs.push(createFormItem('Preço de Venda (R$/sc)', baseId + '-preco', 'text', 'money-mask', 'Informe o preço de venda por saca.'));
            inputs.push(createFormItem('Valor Total (R$)', baseId + '-valor', 'text', 'money-mask', 'Valor total da projeção (calculado automaticamente).'));
        } else if (listType === 'imoveis') {
            inputs.push(createFormItem('Descrição', baseId + '-descricao', 'text', 'full-width', 'Descreva o imóvel.'));
            inputs.push(createFormItem('Valor (R$)', baseId + '-valor', 'text', 'money-mask', 'Informe o valor do imóvel.'));
        } else if (listType === 'veiculos') {
            inputs.push(createFormItem('Descrição', baseId + '-descricao', 'text', 'full-width', 'Descreva o veículo.'));
            inputs.push(createFormItem('Placa', baseId + '-placa', 'text', null, 'Informe a placa do veículo.'));
            inputs.push(createFormItem('Valor (R$)', baseId + '-valor', 'text', 'money-mask', 'Informe o valor do veículo.'));
        } else if (listType === 'maquinas') {
            inputs.push(createFormItem('Descrição', baseId + '-descricao', 'text', 'full-width', 'Descreva a máquina.'));
            inputs.push(createFormItem('Valor (R$)', baseId + '-valor', 'text', 'money-mask', 'Informe o valor da máquina.'));
        } else if (listType === 'areas-proprias') {
            inputs.push(createFormItem('Área (ha)', baseId + '-area', 'text', null, 'Informe o tamanho da área própria em hectares.'));
            inputs.push(createFormItem('Descrição', baseId + '-descricao', 'text', 'full-width', 'Descreva a área própria.'));
        } else if (listType === 'areas-arrendadas') {
            inputs.push(createFormItem('Área (ha)', baseId + '-area', 'text', null, 'Informe o tamanho da área arrendada em hectares.'));
            inputs.push(createFormItem('Descrição', baseId + '-descricao', 'text', 'full-width', 'Descreva a área arrendada.'));
        } else if (listType === 'seguros') {
            inputs.push(createFormItem('Tipo de Seguro', baseId + '-tipo', 'text', null, 'Informe o tipo de seguro.'));
            inputs.push(createFormItem('Valor (R$)', baseId + '-valor', 'text', 'money-mask', 'Informe o valor do seguro.'));
        } else if (listType === 'conglomerado') {
            inputs.push(createFormItem('Nome da Empresa', baseId + '-nome', 'text', null, 'Informe o nome da empresa no conglomerado.'));
            inputs.push(createFormitem('CNPJ', baseId + '-cnpj', 'text', null, 'Informe o CNPJ da empresa.'));
        }

        inputs.forEach(input => item.appendChild(input));
        
        const removeButton = document.createElement('button');
        removeButton.className = 'remove-button';
        removeButton.textContent = 'Remover';
        removeButton.onclick = () => {
            item.remove();
            recalculateTotals();
        };

        item.appendChild(removeButton);
        container.appendChild(item);
        reapplyAllMasks();
        if (listType === 'renda-safra' || listType === 'projecao-safra') {
            item.querySelectorAll('.money-mask, input[type="text"]:not(.money-mask)').forEach(input => {
                input.addEventListener('input', () => calcularValorProducao(item));
            });
        }
    }

    function getNumberFromMaskedValue(value) {
        if (!value) return 0;
        return parseFloat(value.replace(/\./g, '').replace(',', '.'));
    }
    
    function formatToMoney(number) {
        return new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL',
            minimumFractionDigits: 2
        }).format(number);
    }
    
    function calcularValorProducao(item) {
        const areaInput = item.querySelector('[name*="-area"]');
        const produtividadeInput = item.querySelector('[name*="-produtividade"]');
        const precoInput = item.querySelector('[name*="-preco"]');
        const valorTotalInput = item.querySelector('[name*="-valor"]');

        if (areaInput && produtividadeInput && precoInput && valorTotalInput) {
            const area = parseFloat(areaInput.value.replace(',', '.')) || 0;
            const produtividade = parseFloat(produtividadeInput.value.replace(',', '.')) || 0;
            const preco = getNumberFromMaskedValue(precoInput.value);

            const valorTotal = area * produtividade * preco;
            valorTotalInput.value = formatToMoney(valorTotal).replace('R$', '').trim();
            valorTotalInput.title = formatToMoney(valorTotal).replace('R$', '').trim();
        }
    }

    function calcularTotalRendas() {
        // Esta função pode ser usada para somar valores de diferentes seções dinâmicas
        // e atualizar um campo de total, se necessário.
    }
    
    function recalculateTotals() {
        document.querySelectorAll('.renda-safra-item, .projecao-safra-item').forEach(item => calcularValorProducao(item));
        calcularTotalRendas();
    }
    
    function toggleConjugeFields() {
        const estadoCivil = document.getElementById('estadoCivil').value;
        const conjugeFields = document.getElementById('conjugeFields');
        const conjugeCpfFields = document.getElementById('conjugeCpfFields');
        if (estadoCivil === 'casado' || estadoCivil === 'uniao_estavel') {
            conjugeFields.style.display = 'flex';
            conjugeCpfFields.style.display = 'flex';
        } else {
            conjugeFields.style.display = 'none';
            conjugeCpfFields.style.display = 'none';
        }
    }

    function togglePepFields() {
        const pepCheckbox = document.getElementById('pep');
        const pepRelacionamentoFields = document.getElementById('pepRelacionamentoFields');
        if (pepCheckbox.checked) {
            pepRelacionamentoFields.style.display = 'flex';
        } else {
            pepRelacionamentoFields.style.display = 'none';
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        applyMasks();
        document.getElementById('estadoCivil').addEventListener('change', toggleConjugeFields);
        document.getElementById('pep').addEventListener('change', togglePepFields);

        // Funções de exportação e importação
        const saveBtn = document.getElementById('saveBtn');
        saveBtn.addEventListener('click', () => {
            const form = document.getElementById('fichaCadastralForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                if (!data[key]) {
                    data[key] = value;
                } else if (Array.isArray(data[key])) {
                    data[key].push(value);
                } else {
                    data[key] = [data[key], value];
                }
            });

            // Coleta os dados dos campos dinâmicos
            data.rendasSafra = collectDynamicData('rendas-safra-container', ['ano', 'tipo', 'area', 'produtividade', 'preco', 'valor']);
            data.projecaoSafra = collectDynamicData('projecao-safra-container', ['ano', 'tipo', 'area', 'produtividade', 'preco', 'valor']);
            data.imoveis = collectDynamicData('imoveis-container', ['descricao', 'valor']);
            data.veiculos = collectDynamicData('veiculos-container', ['descricao', 'placa', 'valor']);
            data.maquinas = collectDynamicData('maquinas-container', ['descricao', 'valor']);
            data.areasProprias = collectDynamicData('areas-proprias-container', ['area', 'descricao']);
            data.areasArrendadas = collectDynamicData('areas-arrendadas-container', ['area', 'descricao']);
            data.seguros = collectDynamicData('seguros-container', ['tipo', 'valor']);
            data.conglomerado = collectDynamicData('conglomerado-container', ['nome', 'cnpj']);

            // Remove campos duplicados que foram capturados por formData
            delete data.ano;
            delete data.tipo;
            delete data.area;
            delete data.produtividade;
            delete data.preco;
            delete data.valor;
            delete data.descricao;
            delete data.placa;
            delete data.nome;
            delete data.cnpj;
            delete data.pepRelacionamento;
            delete data.pep;

            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ficha_cadastral.json';
            a.click();
            URL.revokeObjectURL(url);
            alert('Dados exportados com sucesso!');
        });

        function collectDynamicData(containerId, fieldNames) {
            const container = document.getElementById(containerId);
            const items = container.querySelectorAll('.list-item');
            const dataList = [];
            items.forEach((item) => {
                const itemData = {};
                fieldNames.forEach(fieldName => {
                    const input = item.querySelector(`[name*="-${fieldName}"]`);
                    if (input) {
                        itemData[fieldName] = input.value;
                    }
                });
                dataList.push(itemData);
            });
            return dataList;
        }

        const loadBtn = document.getElementById('loadBtn');
        loadBtn.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // Limpa os campos dinâmicos antes de popular
                            document.getElementById('rendas-safra-container').innerHTML = '';
                            document.getElementById('projecao-safra-container').innerHTML = '';
                            document.getElementById('imoveis-container').innerHTML = '';
                            document.getElementById('veiculos-container').innerHTML = '';
                            document.getElementById('maquinas-container').innerHTML = '';
                            document.getElementById('areas-proprias-container').innerHTML = '';
                            document.getElementById('areas-arrendadas-container').innerHTML = '';
                            document.getElementById('seguros-container').innerHTML = '';
                            document.getElementById('conglomerado-container').innerHTML = '';

                            // Preenche os campos estáticos
                            if (data.nome) document.getElementById('nome').value = data.nome;
                            if (data.cpf) document.getElementById('cpf').value = data.cpf;
                            if (data.rg) document.getElementById('rg').value = data.rg;
                            if (data.dataNascimento) document.getElementById('dataNascimento').value = data.dataNascimento;
                            if (data.estadoCivil) document.getElementById('estadoCivil').value = data.estadoCivil;
                            if (data.nomeConjuge) document.getElementById('nomeConjuge').value = data.nomeConjuge;
                            if (data.cpfConjuge) document.getElementById('cpfConjuge').value = data.cpfConjuge;
                            if (data.endereco) document.getElementById('endereco').value = data.endereco;
                            if (data.cidade) document.getElementById('cidade').value = data.cidade;
                            if (data.estado) document.getElementById('estado').value = data.estado;
                            if (data.telefone) document.getElementById('telefone').value = data.telefone;
                            if (data.email) document.getElementById('email').value = data.email;
                            if (data.atividade) document.getElementById('atividade').value = data.atividade;
                            if (data.pep) document.getElementById('pep').checked = data.pep === 'on' || data.pep === true;
                            if (data.pepRelacionamento) document.getElementById('pepRelacionamento').value = data.pepRelacionamento;
                            if (data.rendaTotalMensal) document.getElementById('rendaTotalMensal').value = data.rendaTotalMensal;
                            if (data.patrimonioTotal) document.getElementById('patrimonioTotal').value = data.patrimonioTotal;
                            
                            const populateDynamicItems = (containerId, items) => {
                                items.forEach(itemData => {
                                    const container = document.getElementById(containerId);
                                    const listType = containerId.replace('-container', '');
                                    addDynamicItem(containerId, listType);
                                    const newItem = container.lastChild;
                                    for (const key in itemData) {
                                        const input = newItem.querySelector(`[name*="-${key}"]`);
                                        if (input) {
                                            input.value = itemData[key];
                                        }
                                    }
                                });
                            };

                            if(data.rendasSafra) populateDynamicItems('rendas-safra-container', data.rendasSafra);
                            if(data.projecaoSafra) populateDynamicItems('projecao-safra-container', data.projecaoSafra);
                            if(data.imoveis) populateDynamicItems('imoveis-container', data.imoveis);
                            if(data.veiculos) populateDynamicItems('veiculos-container', data.veiculos);
                            if(data.maquinas) populateDynamicItems('maquinas-container', data.maquinas);
                            if(data.areasProprias) populateDynamicItems('areas-proprias-container', data.areasProprias);
                            if(data.areasArrendadas) populateDynamicItems('areas-arrendadas-container', data.areasArrendadas);
                            if(data.seguros) populateDynamicItems('seguros-container', data.seguros);
                            if(data.conglomerado) populateDynamicItems('conglomerado-container', data.conglomerado);


                            reapplyAllMasks();
                            document.querySelectorAll('.renda-safra-item, .projecao-safra-item').forEach(item => calcularValorProducao(item));
                            calcularTotalRendas();
                            toggleConjugeFields();
                            togglePepFields();
                            togglePepRelacionamentoFields();
                            
                            alert('Dados importados com sucesso!');
                        } catch (error) {
                            alert('Erro ao ler o arquivo JSON.');
                            console.error('Erro de parsing do JSON:', error);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        };
    });
</script>

       </body>
</html>
